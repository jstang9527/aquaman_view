{"remainingRequest":"/home/views/aquaman_view/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/views/aquaman_view/src/views/mars/task.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/views/aquaman_view/src/views/mars/task.vue","mtime":1601261308749},{"path":"/home/views/aquaman_view/node_modules/cache-loader/dist/cjs.js","mtime":1601261325203},{"path":"/home/views/aquaman_view/node_modules/babel-loader/lib/index.js","mtime":1601261365222},{"path":"/home/views/aquaman_view/node_modules/cache-loader/dist/cjs.js","mtime":1601261325203},{"path":"/home/views/aquaman_view/node_modules/vue-loader/lib/index.js","mtime":1601261366062}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IEFkZFRhc2ssIFVwZGF0ZVRhc2ssIFRhc2tEZXRhaWwgfSBmcm9tICJAL2FwaS9tYXJzIjsKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBpc0VkaXRQYWdlOiBmYWxzZSwgLy/mmK/liJvlu7rov5jmmK/kv67mlLnku7vliqHnmoTpobXpnaLvvJ8KICAgICAgc3VibWl0QnRuRGlzYWJsZWQ6IGZhbHNlLAogICAgICB0aXRsZTogIuWIm+W7uuS7u+WKoSIsCiAgICAgIGZvcm06IHsKICAgICAgICB0YXNrX25hbWU6ICIiLAogICAgICAgIHRhcmdldF9saXN0OiAiIiwgLy9cbiAtPiAsIOaNouihjOabtOaNoumAl+WPtwogICAgICAgIG9wZW5fd2ViOiAxLAogICAgICAgIHNjYW5fdHlwZTogdW5kZWZpbmVkLCAvL+WujOWFqOaJq+aPjwogICAgICAgIG9wZW5fcG9jOiAxLAogICAgICAgIHByb3RvY29sOiBbXSwgIC8v5Y2P6K6uIG1zZiBzZWFyY2ggeHh4CiAgICAgICAgb3Blbl9leHA6IDEsCiAgICAgIH0sCiAgICAgIG9wdGlvbnM6IFsiU01CIiwgIkZUUCIsICJSRFAiLCAiU1NIIl0sCiAgICAgIHRhc2tfaWQ6IHVuZGVmaW5lZCwKICAgIH07CiAgfSwKICBjcmVhdGVkKCkgewogICAgbGV0IGlkID0gdGhpcy4kcm91dGUucXVlcnkuaWQKICAgIGlmIChpZCkgeyAvL+eCueWHu+S/ruaUuemhtemdoueahOi3s+i9rGlkIHVyaeWPguaVsCg/aWQ9NjQpCiAgICAgIC8vIOWmguaenOaciWlkLOafpURC6L+b6KGM6LWL5YC8CiAgICAgIHRoaXMudGl0bGUgPSAi5L+u5pS55Lu75YqhIgogICAgICB0aGlzLmlzRWRpdFBhZ2UgPSB0cnVlCiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZQogICAgICB0aGlzLnRhc2tfaWQgPSBOdW1iZXIoaWQpCiAgICAgIHRoaXMuZ2V0RGV0YWlsKGlkKQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgLy8g6KGo5qC85qC85byP5qOA5p+lCiAgICBmb3JtQ2hlY2soKSB7CiAgICAgIGlmICh0aGlzLmZvcm0udGFza19uYW1lID09ICIiKSB7IHRoaXMuJG1lc3NhZ2UoeyBtZXNzYWdlOiAi5Lu75Yqh5ZCN5b+F5aGrIiwgdHlwZTogIndhcm5pbmciIH0pOyByZXR1cm4gZmFsc2UgfQogICAgICBpZiAodGhpcy5mb3JtLnRhcmdldF9saXN0ID09ICIiKSB7IHRoaXMuJG1lc3NhZ2UoeyBtZXNzYWdlOiAi5Lu75Yqh55uu5qCH5b+F5aGrIiwgdHlwZTogIndhcm5pbmciIH0pOyByZXR1cm4gZmFsc2UgfQogICAgICBpZiAodGhpcy5mb3JtLm9wZW5fd2ViID09IDEpIHsKICAgICAgICBpZiAoIXRoaXMuZm9ybS5zY2FuX3R5cGUpIHsgdGhpcy4kbWVzc2FnZSh7IG1lc3NhZ2U6ICLmiavmj4/nsbvlnovlv4XloasiLCB0eXBlOiAid2FybmluZyIgfSk7IHJldHVybiBmYWxzZSB9CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZm9ybS5vcGVuX3BvYyA9PSAxKSB7CiAgICAgICAgaWYgKHRoaXMuZm9ybS5wcm90b2NvbC5sZW5ndGggPT0gMCkgeyB0aGlzLiRtZXNzYWdlKHsgbWVzc2FnZTogIuWNj+iuruW/heWhqyIsIHR5cGU6ICJ3YXJuaW5nIiB9KTsgcmV0dXJuIGZhbHNlIH0KICAgICAgfQogICAgICByZXR1cm4gdHJ1ZQogICAgfSwKICAgIGNsb3NlQ2hpbGRQYWdlKCkgewogICAgICB0aGlzLiRyb3V0ZXIuZ28oLTEpCiAgICAgIHRoaXMuJHN0b3JlLnN0YXRlLnRhZ3NWaWV3LnZpc2l0ZWRWaWV3cy5zcGxpY2UodGhpcy4kc3RvcmUuc3RhdGUudGFnc1ZpZXcudmlzaXRlZFZpZXdzLmZpbmRJbmRleChpdGVtID0+IGl0ZW0ucGF0aCA9PT0gdGhpcy4kcm91dGUucGF0aCksIDEpCiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHRoaXMuJHN0b3JlLnN0YXRlLnRhZ3NWaWV3LnZpc2l0ZWRWaWV3c1t0aGlzLiRzdG9yZS5zdGF0ZS50YWdzVmlldy52aXNpdGVkVmlld3MubGVuZ3RoIC0gMV0ucGF0aCkKICAgIH0sCiAgICAvLyDmm7TmlrDku7vliqEKICAgIG9uVXBkYXRlKCkgewogICAgICBpZiAoIXRoaXMuZm9ybUNoZWNrKCkpIHsgcmV0dXJuIH0KICAgICAgdGhpcy5zdWJtaXRCdG5EaXNhYmxlZCA9IHRydWUKICAgICAgLy8gLy8xLue7hOijheaVsOaNrgogICAgICB0aGlzLmZvcm0udGFyZ2V0X2xpc3QgPSB0aGlzLmZvcm0udGFyZ2V0X2xpc3QucmVwbGFjZSgvXG4vZywgIiwiKTsKICAgICAgbGV0IHB1dERhdGEgPSB7CiAgICAgICAgaWQ6IHRoaXMudGFza19pZCwKICAgICAgICB0YXNrX25hbWU6IHRoaXMuZm9ybS50YXNrX25hbWUsCiAgICAgICAgdGFyZ2V0X2xpc3Q6IHRoaXMuZm9ybS50YXJnZXRfbGlzdCwKICAgICAgICBvcGVuX3dlYjogdGhpcy5mb3JtLm9wZW5fd2ViLAogICAgICAgIHNjYW5fdHlwZTogdGhpcy5mb3JtLnNjYW5fdHlwZSwKICAgICAgICBvcGVuX3BvYzogdGhpcy5mb3JtLm9wZW5fcG9jLAogICAgICAgIHByb3RvY29sOiB0aGlzLmZvcm0ucHJvdG9jb2wsCiAgICAgICAgb3Blbl9leHA6IHRoaXMuZm9ybS5vcGVuX2V4cCwKICAgICAgfQogICAgICAvLzIu6LCDQVBJ5o6l5Y+jCiAgICAgIFVwZGF0ZVRhc2socHV0RGF0YSkudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICB0aGlzLnN1Ym1pdEJ0bkRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgdGhpcy5jbGVhckZvcm1EYXRhKCk7CiAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSkKICAgICAgICB0aGlzLiRub3RpZnkoeyB0aXRsZTogcmVzcG9uc2UuZGF0YSwgbWVzc2FnZTogIuabtOaWsOaIkOWKnyBbaWQ6ICIgKyB0aGlzLnRhc2tfaWQgKyAiIF0iLCB0eXBlOiAic3VjY2VzcyIsIGR1cmF0aW9uOiA1MDAwLCB9KTsKICAgICAgICB0aGlzLmNsb3NlQ2hpbGRQYWdlKCkKICAgICAgfSkuY2F0Y2goKCkgPT4gewogICAgICAgIHRoaXMuc3VibWl0QnRuRGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLiRub3RpZnkoeyB0aXRsZTogIkZhaWxlZCIsIG1lc3NhZ2U6ICLmm7TmlrDlpLHotKUgW2lkOiAiICsgdGhpcy50YXNrX2lkICsgIiBdIiwgdHlwZTogImVycm9yIiwgZHVyYXRpb246IDUwMDAsIH0pOwogICAgICB9KTsKICAgIH0sCiAgICAvL+WIm+W7uuS7u+WKoQogICAgb25TdWJtaXQoKSB7CiAgICAgIGlmICghdGhpcy5mb3JtQ2hlY2soKSkgeyByZXR1cm4gfQogICAgICB0aGlzLnN1Ym1pdEJ0bkRpc2FibGVkID0gdHJ1ZQogICAgICAvLzEu57uE6KOF5pWw5o2uCiAgICAgIHRoaXMuZm9ybS50YXJnZXRfbGlzdCA9IHRoaXMuZm9ybS50YXJnZXRfbGlzdC5yZXBsYWNlKC9cbi9nLCAiLCIpOwogICAgICAvLzIu6LCDQVBJ5o6l5Y+jCiAgICAgIEFkZFRhc2sodGhpcy5mb3JtKS50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIHRoaXMuc3VibWl0QnRuRGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLmNsZWFyRm9ybURhdGEoKTsKICAgICAgICB0aGlzLiRub3RpZnkoeyB0aXRsZTogIlN1Y2Nlc3MiLCBtZXNzYWdlOiAi5re75Yqg5oiQ5YqfIiArIHJlc3BvbnNlLmRhdGEuZXJybXNnLCB0eXBlOiAic3VjY2VzcyIsIGR1cmF0aW9uOiA1MDAwLCB9KTsKICAgICAgfSkuY2F0Y2goKCkgPT4gewogICAgICAgIHRoaXMuc3VibWl0QnRuRGlzYWJsZWQgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAogICAgLy8g5o+Q5Lqk5oiQ5Yqf5riF56m65b2T5YmN6aG16Z2i5pWw5o2uCiAgICBjbGVhckZvcm1EYXRhKCkgewogICAgICB0aGlzLmZvcm0gPSB7CiAgICAgICAgdGFza19uYW1lOiAiIiwgdGFyZ2V0X2xpc3Q6ICIiLCBvcGVuX3dlYjogMSwgc2Nhbl90eXBlOiB1bmRlZmluZWQsIG9wZW5fcG9jOiAxLCBwcm90b2NvbDogW10sIG9wZW5fZXhwOiAxLAogICAgICB9CiAgICB9LAogICAgZ2V0RGV0YWlsKGlkKSB7CiAgICAgIGxldCBxdWVyeSA9IHsgaWQ6IGlkIH0KICAgICAgVGFza0RldGFpbChxdWVyeSkudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICB0aGlzLnN1Ym1pdEJ0bkRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgdGhpcy5mb3JtID0gcmVzcG9uc2UuZGF0YQogICAgICB9KS5jYXRjaCgoKSA9PiB7CiAgICAgICAgdGhpcy5zdWJtaXRCdG5EaXNhYmxlZCA9IHRydWU7CiAgICAgIH0pOwogICAgfSwKICB9Cn0K"},{"version":3,"sources":["task.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"task.vue","sourceRoot":"src/views/mars","sourcesContent":["<template>\n  <div class=\"mixin-components-container\">\n    <el-row>\n      <el-card class=\"box-card\">\n        <div slot=\"header\" class=\"clearfix\">\n          <span>{{title}}</span>\n        </div>\n        <div style=\"margin-bottom:50px;\">\n          <el-form ref=\"form\" :model=\"form\" label-width=\"140px\">\n            <el-form-item label=\"任务名\" class=\"is-required\">\n              <el-input v-model=\"form.task_name\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"任务目标\" class=\"is-required\">\n              <el-input type=\"textarea\" v-model=\"form.target_list\" :autosize=\"{ minRows: 2, maxRows: 4}\" placeholder=\"格式:http://example.com,多条换行\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"开启Web漏洞扫描\">\n              <el-switch v-model=\"form.open_web\" active-color=\"#13ce66\" :active-value=\"1\" :inactive-value=\"0\" />\n            </el-form-item>\n            <el-form-item v-if=\"form.open_web\" label=\"扫描类型\">\n              <el-select v-model=\"form.scan_type\" placeholder=\"请选择\" style=\"width:200px\">\n                <el-option label=\"完全扫描\" :value=\"1\"></el-option>\n                <el-option label=\"高危扫描\" :value=\"2\"></el-option>\n                <el-option label=\"XSS检测\" :value=\"3\"></el-option>\n                <el-option label=\"SQL注入\" :value=\"4\"></el-option>\n                <el-option label=\"弱口令检测\" :value=\"5\"></el-option>\n                <el-option label=\"Web指纹\" :value=\"6\"></el-option>\n              </el-select>\n            </el-form-item>\n            <el-form-item label=\"开启Poc检测\">\n              <el-switch v-model=\"form.open_poc\" active-color=\"#13ce66\" :active-value=\"1\" :inactive-value=\"0\" />\n            </el-form-item>\n            <el-form-item v-if=\"form.open_poc\" label=\"选择协议\">\n              <el-select v-model=\"form.protocol\" multiple placeholder=\"请选择\" size=\"medium\">\n                <el-option v-for=\"(index,item) in options\" :key=\"item\" :label=\"index\" :value=\"index\"></el-option>\n              </el-select>\n            </el-form-item>\n            <el-form-item label=\"开启漏洞利用\">\n              <el-switch v-model=\"form.open_exp\" active-color=\"#FF4500\" :active-value=\"1\" :inactive-value=\"0\" />\n            </el-form-item>\n            <el-form-item>\n              <el-button v-if=\"isEditPage\" type=\"danger\" :disabled=\"submitBtnDisabled\" @click=\"onUpdate()\">提交修改</el-button>\n              <el-button v-else type=\"primary\" :disabled=\"submitBtnDisabled\" @click=\"onSubmit()\">立即创建</el-button>\n            </el-form-item>\n          </el-form>\n        </div>\n      </el-card>\n    </el-row>\n  </div>\n</template>\n\n<script>\nimport { AddTask, UpdateTask, TaskDetail } from \"@/api/mars\";\nexport default {\n  data() {\n    return {\n      isEditPage: false, //是创建还是修改任务的页面？\n      submitBtnDisabled: false,\n      title: \"创建任务\",\n      form: {\n        task_name: \"\",\n        target_list: \"\", //\\n -> , 换行更换逗号\n        open_web: 1,\n        scan_type: undefined, //完全扫描\n        open_poc: 1,\n        protocol: [],  //协议 msf search xxx\n        open_exp: 1,\n      },\n      options: [\"SMB\", \"FTP\", \"RDP\", \"SSH\"],\n      task_id: undefined,\n    };\n  },\n  created() {\n    let id = this.$route.query.id\n    if (id) { //点击修改页面的跳转id uri参数(?id=64)\n      // 如果有id,查DB进行赋值\n      this.title = \"修改任务\"\n      this.isEditPage = true\n      this.isLoading = true\n      this.task_id = Number(id)\n      this.getDetail(id)\n    }\n  },\n  methods: {\n    // 表格格式检查\n    formCheck() {\n      if (this.form.task_name == \"\") { this.$message({ message: \"任务名必填\", type: \"warning\" }); return false }\n      if (this.form.target_list == \"\") { this.$message({ message: \"任务目标必填\", type: \"warning\" }); return false }\n      if (this.form.open_web == 1) {\n        if (!this.form.scan_type) { this.$message({ message: \"扫描类型必填\", type: \"warning\" }); return false }\n      }\n      if (this.form.open_poc == 1) {\n        if (this.form.protocol.length == 0) { this.$message({ message: \"协议必填\", type: \"warning\" }); return false }\n      }\n      return true\n    },\n    closeChildPage() {\n      this.$router.go(-1)\n      this.$store.state.tagsView.visitedViews.splice(this.$store.state.tagsView.visitedViews.findIndex(item => item.path === this.$route.path), 1)\n      this.$router.push(this.$store.state.tagsView.visitedViews[this.$store.state.tagsView.visitedViews.length - 1].path)\n    },\n    // 更新任务\n    onUpdate() {\n      if (!this.formCheck()) { return }\n      this.submitBtnDisabled = true\n      // //1.组装数据\n      this.form.target_list = this.form.target_list.replace(/\\n/g, \",\");\n      let putData = {\n        id: this.task_id,\n        task_name: this.form.task_name,\n        target_list: this.form.target_list,\n        open_web: this.form.open_web,\n        scan_type: this.form.scan_type,\n        open_poc: this.form.open_poc,\n        protocol: this.form.protocol,\n        open_exp: this.form.open_exp,\n      }\n      //2.调API接口\n      UpdateTask(putData).then((response) => {\n        this.submitBtnDisabled = false;\n        this.clearFormData();\n        console.log(response.data)\n        this.$notify({ title: response.data, message: \"更新成功 [id: \" + this.task_id + \" ]\", type: \"success\", duration: 5000, });\n        this.closeChildPage()\n      }).catch(() => {\n        this.submitBtnDisabled = false;\n        this.$notify({ title: \"Failed\", message: \"更新失败 [id: \" + this.task_id + \" ]\", type: \"error\", duration: 5000, });\n      });\n    },\n    //创建任务\n    onSubmit() {\n      if (!this.formCheck()) { return }\n      this.submitBtnDisabled = true\n      //1.组装数据\n      this.form.target_list = this.form.target_list.replace(/\\n/g, \",\");\n      //2.调API接口\n      AddTask(this.form).then((response) => {\n        this.submitBtnDisabled = false;\n        this.clearFormData();\n        this.$notify({ title: \"Success\", message: \"添加成功\" + response.data.errmsg, type: \"success\", duration: 5000, });\n      }).catch(() => {\n        this.submitBtnDisabled = false;\n      });\n    },\n    // 提交成功清空当前页面数据\n    clearFormData() {\n      this.form = {\n        task_name: \"\", target_list: \"\", open_web: 1, scan_type: undefined, open_poc: 1, protocol: [], open_exp: 1,\n      }\n    },\n    getDetail(id) {\n      let query = { id: id }\n      TaskDetail(query).then((response) => {\n        this.submitBtnDisabled = false;\n        this.form = response.data\n      }).catch(() => {\n        this.submitBtnDisabled = true;\n      });\n    },\n  }\n}\n</script>\n\n<style>\n.mixin-components-container {\n  background-color: #f0f2f5;\n  padding: 30px;\n  min-height: calc(100vh - 84px);\n}\n.text {\n  font-size: 14px;\n}\n.clearfix:before,\n.clearfix:after {\n  display: table;\n  content: \"\";\n}\n.clearfix:after {\n  clear: both;\n}\n.box-card-in {\n  width: 60%;\n}\n.dump-box {\n  font-weight: 700;\n  color: #606266;\n}\n</style>"]}]}