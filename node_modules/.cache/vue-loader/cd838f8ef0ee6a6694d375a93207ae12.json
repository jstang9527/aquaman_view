{"remainingRequest":"/home/views/opentest_view/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/views/opentest_view/src/views/chain/block.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"/home/views/opentest_view/src/views/chain/block.vue","mtime":1597395315124},{"path":"/home/views/opentest_view/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/views/opentest_view/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/views/opentest_view/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/views/opentest_view/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/views/opentest_view/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoubWl4aW4tY29tcG9uZW50cy1jb250YWluZXIgewogIGJhY2tncm91bmQtY29sb3I6ICNmMGYyZjU7CiAgcGFkZGluZzogMzBweDsKICBtaW4taGVpZ2h0OiBjYWxjKDEwMHZoIC0gODRweCk7Cn0KLnRleHQgewogIGZvbnQtc2l6ZTogMTRweDsKfQouY2xlYXJmaXg6YmVmb3JlLAouY2xlYXJmaXg6YWZ0ZXIgewogIGRpc3BsYXk6IHRhYmxlOwogIGNvbnRlbnQ6ICIiOwp9Ci5jbGVhcmZpeDphZnRlciB7CiAgY2xlYXI6IGJvdGg7Cn0KLmJveC1jYXJkLWluIHsKICB3aWR0aDogNjAlOwp9Ci5kdW1wLWJveCB7CiAgZm9udC13ZWlnaHQ6IDcwMDsKICBjb2xvcjogIzYwNjI2NjsKfQo="},{"version":3,"sources":["block.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"block.vue","sourceRoot":"src/views/chain","sourcesContent":["<template>\n  <div class=\"mixin-components-container\">\n    <el-row>\n      <el-card class=\"box-card\">\n        <div slot=\"header\" class=\"clearfix\">\n          <span>{{title}}</span>\n        </div>\n        <div style=\"margin-bottom:50px;\">\n          <el-form ref=\"form\" :model=\"form\" label-width=\"140px\">\n            <el-form-item label=\"组件名\" class=\"is-required\">\n              <el-input v-model=\"form.block_name\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"重要性\" class=\"is-required\">\n              <el-select v-model=\"form.priority\" placeholder=\"请选择\">\n                <el-option label=\"Low\" :value=\"1\"></el-option>\n                <el-option label=\"Nonal\" :value=\"2\"></el-option>\n                <el-option label=\"High\" :value=\"3\"></el-option>\n              </el-select>\n            </el-form-item>\n            <el-form-item label=\"期望值\">\n              <el-input v-model=\"form.expect\" placeholder=\"指执行完该链后期望匹配到的值\" disabled></el-input>\n            </el-form-item>\n            <el-form-item>\n              <el-card class=\"box-card-in\">\n                <div slot=\"header\" class=\"clearfix\">\n                  <span class=\"dump-box\">动作链</span>\n                  <el-button style=\"float: right; margin-top: 3px;\" type=\"text\" @click=\"openDialog()\">添加动作</el-button>\n                </div>\n                <el-timeline>\n                  <el-timeline-item v-for=\"(activity, index) in list\" :key=\"index\" :color=\"'#0bbd87'\" :timestamp=\"activity.timestamp\">\n                    {{activity.action_name}}\n                    <el-button type=\"danger\" size=\"mini\" style=\"float: right; margin-top: 3px;\" @click=\"delListItem(index)\">删除</el-button>\n                    <el-button type=\"primary\" size=\"mini\" style=\"float: right; margin-right:3px; margin-top: 3px;\" @click=\"editListItem(index)\">修改</el-button>\n                  </el-timeline-item>\n                </el-timeline>\n              </el-card>\n            </el-form-item>\n            <el-form-item>\n              <el-button v-if=\"isEditPage\" type=\"danger\" :disabled=\"submitBtnDisabled\" @click=\"onUpdate()\">提交修改</el-button>\n              <el-button v-else type=\"primary\" :disabled=\"submitBtnDisabled\" @click=\"onSubmit(0)\">立即创建</el-button>\n              <!-- <el-button>取消</el-button> -->\n            </el-form-item>\n          </el-form>\n        </div>\n      </el-card>\n    </el-row>\n    <!--弹出组件-->\n    <el-dialog title=\"动作\" :visible.sync=\"dialog\">\n      <el-form ref=\"dataForm\" :model=\"temp\" label-position=\"left\" label-width=\"120px\" style=\"width: 400px; margin-left:50px;\">\n        <el-form-item label=\"动作名\" class=\"is-required\" style=\"width:500px;\">\n          <el-input v-model=\"temp.action_name\" />\n        </el-form-item>\n        <el-form-item label=\"动作\" class=\"is-required\">\n          <el-select v-model=\"temp.event_type\" placeholder=\"请选择\">\n            <el-option label=\"进入/切换页面\" :value=\"1\"></el-option>\n            <el-option label=\"输入事件\" :value=\"2\"></el-option>\n            <el-option label=\"点击事件\" :value=\"3\"></el-option>\n            <el-option label=\"监听事件\" :value=\"4\"></el-option>\n            <el-option label=\"抓取表格数据\" :value=\"5\"></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"请输入URL\">\n          <el-input v-model=\"temp.url\" placeholder=\"/#/login\" style=\"width:500px;\" />\n        </el-form-item>\n        <el-form-item label=\"元素检索\">\n          <el-select v-model=\"temp.search_type\" clearable placeholder=\"请选择\">\n            <el-option label=\"属性ID\" :value=\"1\"></el-option>\n            <el-option label=\"XPath\" :value=\"2\"></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"属性ID\">\n          <el-input v-model=\"temp.element_id\" placeholder=\"username\" style=\"width:500px;\" />\n        </el-form-item>\n        <el-form-item label=\"Xpath\">\n          <el-input v-model=\"temp.xpath\" placeholder=\"//*/div/h1/text\" style=\"width:500px;\" />\n        </el-form-item>\n        <el-form-item label=\"输入值|期望值\">\n          <el-input v-model=\"temp.element_value\" placeholder=\"若是输入事件,请输入内容值;若是监听事件，请输入期望值\" style=\"width:500px;\" />\n        </el-form-item>\n        <el-form-item label=\"超时时间\">\n          <el-input v-model=\"temp.timeout\" type=\"number\" oninput=\"if(value.length > 3)value = value.slice(0, 3)\" placeholder=\"在指定时间内检索元素(单位: 秒)\" style=\"width:500px;\" />\n        </el-form-item>\n        <el-form-item label=\"出错为真\">\n          <el-switch v-model=\"temp.allow_err\" active-color=\"#13ce66\" :active-value=\"1\" :inactive-value=\"0\" />\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"cancelConfirm()\">Cancel</el-button>\n        <el-button v-if=\"isEditItem\" type=\"danger\" :disabled=\"submitBtnDisabled\" @click=\"onConfirm(1)\">确认修改</el-button>\n        <el-button v-else type=\"primary\" @click=\"onConfirm(0)\">Confirm</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { chainAddBlock, blockDetail, chainUpdateBlock } from \"@/api/chain\";\nexport default {\n  data() {\n    return {\n      isEditItem: false,\n      isEditPage: false, //是创建还是修改页面？\n      submitBtnDisabled: false,\n      dialog: false,\n      title: \"创建组件\",\n      temp: { id: 0, block_id: 0, action_name: \"\", event_type: undefined, search_type: undefined, url: \"\", element_id: \"\", element_value: \"\", xpath: \"\", timeout: undefined, allow_err: 0 },\n      form: { block_name: \"\", priority: 1, expect: \"\", },\n      list: [],\n      block_id: undefined,\n      curListItemIndex: undefined,//当前修改的列表的下标值\n    };\n  },\n  created() {\n    let id = this.$route.query.id\n    if (id) { //点击修改页面的跳转id uri参数(?id=64)\n      // 如果有id,查DB进行赋值\n      this.title = \"更新组件配置\"\n      this.isEditPage = true\n      this.isLoading = true\n      this.block_id = Number(id)\n      this.getDetail(id)\n    }\n  },\n  methods: {\n    openDialog() {\n      this.dialog = true\n      this.isEditItem = false\n    },\n    // 更新组件配置\n    onUpdate() {\n      if (this.form.block_name == \"\") { this.$message({ message: \"组件名必填\", type: \"warning\" }); return }\n      if (this.form.priority < 1) { this.$message({ message: \"重要性必选\", type: \"warning\" }); return }\n      if (this.list.length == 0) { this.$message({ message: \"动作列表为空\", type: \"warning\" }); return }\n      this.submitBtnDisabled = true\n      //1.组装数据\n      let postData = { id: this.block_id, block_name: this.form.block_name, priority: this.form.priority, expect: this.form.expect, action_chain: this.list }\n      //2.调API接口\n      chainUpdateBlock(postData).then((response) => {\n        this.submitBtnDisabled = false;\n        this.clearFormData();\n        this.$notify({ title: \"Success\", message: \"更新成功 [id:\" + this.block_id + \"]\" + response.data.errmsg, type: \"success\", duration: 5000, });\n        this.$router.go(-1)\n      }).catch(() => {\n        this.submitBtnDisabled = false;\n        this.$notify({ title: \"Failed\", message: \"更新失败 [id:\" + this.block_id + \"]\", type: \"error\", duration: 5000, });\n      });\n    },\n    //提及创建组件\n    onSubmit() {\n      if (this.form.block_name == \"\") { this.$message({ message: \"组件名必填\", type: \"warning\" }); return }\n      if (this.form.priority < 1) { this.$message({ message: \"重要性必选\", type: \"warning\" }); return }\n      if (this.list.length == 0) { this.$message({ message: \"动作列表为空\", type: \"warning\" }); return }\n      this.submitBtnDisabled = true\n      //1.组装数据\n      let postData = { block_name: this.form.block_name, priority: this.form.priority, expect: this.form.expect, action_chain: this.list }\n      //2.调API接口\n      chainAddBlock(postData).then((response) => {\n        this.submitBtnDisabled = false;\n        this.clearFormData();\n        this.$notify({ title: \"Success\", message: \"添加成功\" + response.data.errmsg, type: \"success\", duration: 5000, });\n      }).catch(() => {\n        this.submitBtnDisabled = false;\n      });\n    },\n    cancelConfirm() {\n      this.clearTempData()\n      this.dialog = false\n    },\n    onConfirm(sign) { //弹出框提交\n      let result = { id: 0, block_id: 0, action_name: \"\", event_type: undefined, search_type: undefined, url: \"\", element_id: \"\", element_value: \"\", xpath: \"\", timeout: undefined, allow_err: 0, timestamp: undefined }\n      result.action_name = this.temp.action_name\n      result.event_type = this.temp.event_type\n      if (result.action_name == \"\") { this.$message(\"动作名必填\"); return }\n      if (!result.event_type) { this.$message(\"动作必选\"); return }\n      console.log(\"===>\" + this.temp.event_type)\n\n      //1.判断事件\n      //1.1 页面切换,只保留url\n      if (result.event_type == 1) {\n        if (this.temp.url == \"\") { this.$message(\"URL必填\"); return }\n        result.url = this.temp.url\n      } else {\n        result.search_type = this.temp.search_type\n        if (!result.search_type) { this.$message(\"元素检索必选\"); return }\n      }\n      //1.2输入事件,判断元素检索方式[byid|xpath]\n      if (result.event_type == 2) {\n        if (result.search_type == 1) { //ByID,保留id和value\n          result.element_id = this.temp.element_id\n          result.element_value = this.temp.element_value\n          if (result.element_id == \"\") { this.$message(\"属性ID必填\"); return }\n          if (result.element_value == \"\") { this.$message(\"输入值必填\"); return }\n        } else { //保留xpath\n          result.xpath = this.temp.xpath\n          if (result.xpath == \"\") { this.$message(\"XPath必填\"); return }\n        }\n      }\n      //1.3 点击事件,只保留XPath或ID即可\n      if (result.event_type == 3) {\n        if (result.search_type == 1) { //ByID,保留id\n          result.element_id = this.temp.element_id\n          if (result.element_id == \"\") { this.$message(\"属性ID必填\"); return }\n        } else { //保留xpath\n          result.xpath = this.temp.xpath\n          if (result.xpath == \"\") { this.$message(\"XPath必填\"); return }\n        }\n      }\n      //1.4 监听事件，只保留id|xpath、期望值、超时时间、出错为真\n      if (result.event_type == 4) {\n        result.timeout = this.temp.timeout\n        result.allow_err = this.temp.allow_err\n        result.element_value = this.temp.element_value\n        if (result.search_type == 1) { //ByID,保留id\n          result.element_id = this.temp.element_id\n          if (result.element_id == \"\") { this.$message(\"属性ID必填\"); return }\n        } else { //保留xpath\n          result.xpath = this.temp.xpath\n          if (result.xpath == \"\") { this.$message(\"XPath必填\"); return }\n        }\n        if (result.element_value == \"\") { this.$message(\"期望值必填\"); return }\n      }\n      //1.5 抓取表格数据\n      if (result.event_type == 5) {\n        if (result.search_type == 1) { //ByID,保留id\n          result.element_id = this.temp.element_id\n          if (result.element_id == \"\") { this.$message(\"属性ID必填\"); return }\n        } else { //保留xpath\n          result.xpath = this.temp.xpath\n          if (result.xpath == \"\") { this.$message(\"XPath必填\"); return }\n        }\n      }\n      result.id = this.temp.id\n      result.block_id = this.temp.block_id\n      result.search_type = this.temp.search_type\n      result.url = this.temp.url\n      result.element_id = this.temp.element_id\n      result.element_value = this.temp.element_value\n      result.xpath = this.temp.xpath\n      result.timeout = Number(this.temp.timeout)\n      result.allow_err = this.temp.allow_err\n      result.timestamp = new Date() + \"\"\n\n      //+ 判断是新增还是修改操作\n      if (sign == 1) {//  - 修改 ->改list[index]的值\n        this.list[this.curListItemIndex] = result\n      } else {//  - 新增 ->推给全局list下\n        this.list.push(result)\n      }\n      this.dialog = false\n      this.clearTempData()\n    },\n    delListItem(index) {\n      this.list.splice(index, 1);\n    },\n    // 修改action，本地修改list[index]\n    editListItem(index) {\n      //打开弹出框\n      this.dialog = true\n      this.isEditItem = true\n      this.curListItemIndex = index\n      //对弹出框进行赋值\n      let obj = this.list[index]\n      this.temp = obj\n    },\n    // 提交弹出框后清除temp弹出框数据\n    clearTempData() {\n      this.temp = { action_name: \"\", event_type: undefined, search_type: undefined, url: \"\", element_id: \"\", element_value: \"\", xpath: \"\", timeout: undefined, allow_err: 0 }\n    },\n    // 提交成功清空当前页面数据\n    clearFormData() {\n      this.form = { block_name: \"\", priority: 1, expect: \"\", }\n      this.list = [];\n    },\n    getDetail(id) {\n      let query = { id: id }\n      blockDetail(query).then((response) => {\n        this.list = response.data.actions\n        this.form = response.data.info\n        console.log(this.list)\n        setTimeout(() => { this.isLoading = false; }, 1.5 * 1000);\n      });\n    },\n  }\n}\n</script>\n\n<style>\n.mixin-components-container {\n  background-color: #f0f2f5;\n  padding: 30px;\n  min-height: calc(100vh - 84px);\n}\n.text {\n  font-size: 14px;\n}\n.clearfix:before,\n.clearfix:after {\n  display: table;\n  content: \"\";\n}\n.clearfix:after {\n  clear: both;\n}\n.box-card-in {\n  width: 60%;\n}\n.dump-box {\n  font-weight: 700;\n  color: #606266;\n}\n</style>"]}]}